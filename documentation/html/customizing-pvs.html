<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Transient Recorder Framework: Customizing PVs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Transient Recorder Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Customizing PVs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Customization Script</h1>
<p>A Python (2.7) script <code>customize_pvs.py</code> is provided to customize the names of PVs and macros in DB files. The script is located in <code>TRCore/Db</code> and is copied to <code>TRCore/db</code> during build.</p>
<p>For example, to rename <code>TRBase.db</code> PVs "$(PREFIX):arm" and "$(PREFIX):NUM_BURSTS" to "$(PREFIX).Arm" and "$(PREFIX).NumBursts", run:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;TRCore/Db/customize_pvs.py -s TRCore/TRCoreApp/Db -b TRBase.db -r arm .Arm -r NUM_BURSTS .NumBursts -d &lt;dest-dir&gt;</div></div><!-- fragment --><p>Here, <code>&lt;dest-dir&gt;</code> is the directory where the customized DB files will be written. By default, the new DB files will have the same name as the originals, but if you pass <code>-p &lt;prefix&gt;</code>, they will have a prefix.</p>
<p>The script can also substitute macros. For example, to replace the macro AUTORESTART_ZNAM with "no", pass the following to the script: <code>-m AUTORESTART_ZNAM no</code>.</p>
<h1>Integration into the EPICS Build System</h1>
<p>It is possible to run the script from the EPICS build system using already provided makefile rules. The assumption here is that the module being built depends on TRCore by specifying the variable TR_CORE in its RELEASE file.</p>
<p>Then, the module can generate customized TRCore DB files by including these lines in its Db Makefile:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# This line goes just after &quot;include $(TOP)/configure/CONFIG&quot;.</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;# It is needed only for old EPICS, newer EPICS will include it automatically.</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;# It is okay to add it in any case since it will detect double inclusion.</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;include $(TR_CORE)/cfg/RULES.customize_pvs</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;# This goes in the place where DBs are specified.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# If you want a prefix adjust TR_CUSTOM_DB_PREFIX otherwise leave it empty.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;TR_CUSTOM_DB_PREFIX :=</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;DB += $(addprefix $(TR_CUSTOM_DB_PREFIX),$(TRCORE_CUSTOMIZABLE_DBS))</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;# This goes to the bottom BELOW &quot;#  ADD RULES AFTER THIS LINE&quot;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;DB_CUSTOMIZE := -r arm :Arm -r autoRestart :AutoRestart</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;$(eval $(call TRCORE_CUSTOM_DB_RULES,$(TRCORE_DB_DIR),$(TRCORE_CUSTOMIZABLE_DBS),$(TR_CUSTOM_DB_PREFIX),$(DB_CUSTOMIZE)))</div></div><!-- fragment --><p>The TRCore DBs which are customizable (TRCORE_CUSTOMIZABLE_DBS) are <code>TRBase.db</code>, <code>TRChannel.db</code> and <code>TRChannelData.db</code>.</p>
<p>For your IOC you will of course have to use the resulting customized DB files which will be installed to the <code>db</code> folder of the module that performed this customization, and not the original TRCore files.</p>
<p>You can also use this approach to customize digitizer-specific PVs. Just use the appropriate values instead of TRCORE_CUSTOMIZABLE_DBS and TRCORE_DB_DIR and different variable names to avoid conflicts.</p>
<p>In order to also customize device-specific DBs, add the following lines in addition to the ones shown above. The example is for TRSIS and will need minor adaptations for a different driver.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# This goes in the place where DBs are specified.</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;TRSIS_DBS := TRSIS.db TRSIS_Channel.db</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;DB += $(addprefix $(TR_CUSTOM_DB_PREFIX),$(TRSIS_DBS))</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;# This goes to the bottom BELOW &quot;#  ADD RULES AFTER THIS LINE&quot;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;$(eval $(call TRCORE_CUSTOM_DB_RULES,$(TRSIS)/db,$(TRSIS_DBS),$(TR_CUSTOM_DB_PREFIX),$(DB_CUSTOMIZE)))</div></div><!-- fragment --><p>Here it is assumed that <code>RULES.customize_pvs</code> was already included and that <code>TR_CUSTOM_DB_PREFIX</code> and <code>DB_CUSTOMIZE</code> are already defined, as shown in the previous example.</p>
<p>It is advsed to use the same file prefix and customizations hence the variables <code>TR_CUSTOM_DB_PREFIX</code> and <code>DB_CUSTOMIZE</code> should only be defined once and used both for customization of TRCore and device-specific DBs.</p>
<p>In this example, <code>/db</code> is the location of the non-customized device-specific DBs. The variable name corresponds to the RELEASE variable which points to the driver. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
